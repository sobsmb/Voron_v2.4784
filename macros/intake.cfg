[gcode_macro TOGGLE_INTAKE]
gcode:
    {% if printer['fan_generic intake_fan'].speed > 0 %}
      SET_FAN_SPEED FAN=intake_fan SPEED=0
    {% else %}
      SET_FAN_SPEED FAN=intake_fan SPEED=1
    {% endif %}

[delayed_gcode _DISABLE_INTAKE]
gcode:
  SET_FAN_SPEED FAN=intake_fan SPEED=0

[gcode_macro TIMED_INTAKE]
gcode:
  {% set delay = params.DELAY|default(300)|float %}
  {% set power = params.POWER|default(100)|float %}
  {% if (power > 0) %}
    SET_FAN_SPEED FAN=intake_fan SPEED={power}
  {% endif %}
  UPDATE_DELAYED_GCODE ID=_DISABLE_INTAKE DURATION={delay}