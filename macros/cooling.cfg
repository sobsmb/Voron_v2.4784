[gcode_macro TOGGLE_COOLING]
gcode:
    {% if printer['fan_generic cooling_fan'].speed > 0 %}
      SET_FAN_SPEED FAN=cooling_fan SPEED=0
    {% else %}
      SET_FAN_SPEED FAN=cooling_fan SPEED=1
    {% endif %}

[delayed_gcode _DISABLE_COOLING]
gcode:
  SET_FAN_SPEED FAN=cooling_fan SPEED=0

[gcode_macro TIMED_COOLING]
gcode:
  {% set delay = params.DELAY|default(300)|float %}
  {% set power = params.POWER|default(100)|float %}
  {% if (power > 0) %}
    SET_FAN_SPEED FAN=cooling_fan SPEED={power}
  {% endif %}
  UPDATE_DELAYED_GCODE ID=_DISABLE_COOLING DURATION={delay}