[gcode_macro TOGGLE_EXHAUST]
gcode:
    {% if printer['fan_generic exhaust_fan'].speed > 0 %}
      SET_FAN_SPEED FAN=exhaust_fan SPEED=0
    {% else %}
      SET_FAN_SPEED FAN=exhaust_fan SPEED=1
    {% endif %}

[delayed_gcode _DISABLE_EXHAUST]
gcode:
  SET_FAN_SPEED FAN=exhaust_fan SPEED=0

[gcode_macro TIMED_EXHAUST]
gcode:
  {% set delay = params.DELAY|default(300)|float %}
  {% set power = params.POWER|default(100)|float %}
  {% if (power > 0) %}
    SET_FAN_SPEED FAN=exhaust_fan SPEED={power}
  {% endif %}
  UPDATE_DELAYED_GCODE ID=_DISABLE_EXHAUST DURATION={delay}
